define(["zepto","underscore","modes"],function(e,t,n){var r=function(r){var i=["click","touchstart"],s=function(n,r){t(i).each(function(t){e(n).on(t,r)})};this.mainDrawer=e("#mainDrawer"),this.scoreDrawer=e("#scoreDrawer"),this.spinnerScore=e("#spinner-score")[0],this.timeBonus=e("#time-bonus")[0],this.gameOver=!1,s("#newGame-classic-easy",function(e){e.preventDefault(),r.newMode(new n.EasyMode(r))}),s("#newGame-classic-medium",function(e){e.preventDefault(),r.newMode(new n.MediumMode(r))}),s("#newGame-classic-hard",function(e){e.preventDefault(),r.newMode(new n.HardMode(r))}),s("#newGame-classic-infinite",function(e){e.preventDefault(),r.newMode(new n.InfiniteMode(r))}),s("#pauseButton",function(e){e.preventDefault(),r.pauseGame()}),s("#unpauseButton",function(e){e.preventDefault(),r.pauseGame()}),s("#gameOverTab-tryAgain",function(e){e.preventDefault(),r.tryAgain()}),window.blackberry&&blackberry.app.event.onSwipeDown(t.bind(function(){r.state()===r.states.running?r.pauseGame():this.toggle()},this)),e("#mainDrawer nav li").each(t.bind(function(n,r){var i=e(r).attr("data-tab");s(r,t.bind(function(e){e.preventDefault(),this.showTab(i)},this))},this)),r.on("change:mode",function(e,t){this.setToMode(t)},this),r.on("change:state",function(t,n){if(n===t.states.running)this.hide(),e("#pauseButton").text("pause").css({visibility:"visible"});else if(n===t.states.paused)this.showTab("pausedTab"),e("#pauseButton").text("unpause").css({visibility:"visible"}),this.show();else if(n===t.states.won||n===t.states.lost)this.gameOver=!0,this.showTab("gameOverTab"),e("#pauseButton").css({visibility:"hidden"}),n===t.states.won?e("#gameOverTab .message").text("You did it!"):e("#gameOverTab .message").text("You hit the timer!"),this.show();n!==t.states.paused&&this.hideTab("pausedTab"),n!==t.states.won&&n!==t.states.lost&&(this.hideTab("gameOverTab"),this.gameOver=!1)},this)};return r.prototype={listenToScoreTable:function(t){t.on("change:easy",function(t,n){e("#scoretable_easy").text(n)}),t.on("change:medium",function(t,n){e("#scoretable_medium").text(n)}),t.on("change:hard",function(t,n){e("#scoretable_hard").text(n)}),t.on("change:infinite",function(t,n){e("#scoretable_infinite").text(n)})},listenToScore:function(t){t.on("change",function(t){e(this.spinnerScore).html(t.get("ringsCleared")),e(this.timeBonus).html(t.get("timeBonus"))},this)},updateGameOverTab:function(t,n,r){if(!this.gameOver)return;e("#gameOverTab-totalScore").html(n.total()),e("#gameOverTab .message").html(r),e("#gameOverTab-highScore").html(t),n.total()<t?e("#gameOverTab-comparator").text("<"):n.total()>t?e("#gameOverTab-comparator").text(">"):e("#gameOverTab-comparator").text("=")},setToMode:function(t){if(t!==null){var n=t.getModeString();e("#scoreDrawer-mode").html(n),this.scoreHidden=!1,this.updateTransforms(),this.listenToScore(t.score),e(this.spinnerScore).html("0"),e(this.timeBonus).html("  ")}else this.scoreHidden=!0,this.disablePauseButton(),this.updateTransforms()},updateTransforms:function(){var e=-this.mainDrawer[0].clientHeight,n=t(["-webkit-","-o-","-moz-","-ms-",""]);this.hidden||(e=0),n.each(function(t){this.mainDrawer.css(t+"transform","translateY("+e+"px)")},this),this.scoreHidden&&(e-=this.scoreDrawer[0].clientHeight),n.each(function(t){this.scoreDrawer.css(t+"transform","translateY("+e+"px)")},this)},toggle:function(){this.hidden=!this.hidden,this.updateTransforms()},showTab:function(t){e("#mainDrawer .tab").hide(),e("#mainDrawer nav li").removeAttr("selected"),e('#mainDrawer nav li[data-tab="'+t+'"]').attr("selected",!0).css({display:"block"}),e("#"+t).show()},hideTab:function(t){e('#mainDrawer nav li[data-tab="'+t+'"]').attr("selected",!1).hide()},show:function(){this.hidden&&this.toggle()},hide:function(){this.hidden||this.toggle()},hidden:!1,scoreHidden:!0},r});